
# Spend Time Together

Бэкенд-сервис для приложения "Spend Time Together".

## О проекте

Этот проект представляет собой асинхронное веб-приложение на FastAPI, построенное с использованием чистой архитектуры, внедрения зависимостей и асинхронного взаимодействия с базой данных.

### Основные технологии

*   **Язык:** Python 3.11+
*   **Фреймворк:** FastAPI
*   **База данных:** MySQL (в проде) / SQLite (в тестах)
*   **ORM:** SQLAlchemy 2.0 (asyncio)
*   **DI-контейнер:** `dependency-injector`
*   **Управление зависимостями:** Poetry
*   **Миграции:** Alembic
*   **Контейнеризация:** Docker, Docker Compose
*   **Тестирование:** Pytest, `pytest-asyncio`, `factory-boy`

## Быстрый старт

Для запуска проекта требуется установленный Docker и Docker Compose.

### 1. Клонирование репозитория

```bash
git clone <URL вашего репозитория>
cd spend-time-together
```

### 2. Конфигурация

Проект использует переменные окружения для конфигурации. Создайте файл `.env` в корневой директории проекта, скопировав содержимое из `.env.example`:

```bash
cp .env.example .env
```

При необходимости измените значения в файле `.env`. Стандартные настройки уже подходят для локального запуска через Docker Compose.

### 3. Сборка и запуск приложения

Выполните следующую команду, чтобы собрать Docker-образы и запустить контейнеры в фоновом режиме:

```bash
docker-compose up --build -d
```

*   `--build`: принудительно пересобирает образы.
*   `-d`: запускает контейнеры в фоновом режиме (detached mode).

При запуске контейнера `web` автоматически применяются все последние миграции базы данных.

После успешного запуска приложение будет доступно по адресу `http://localhost:8000`.
Интерактивная документация API (Swagger UI) находится по адресу `http://localhost:8000/docs`.

### 4. Миграции базы данных

Миграции управляются с помощью Alembic. Подробную информацию можно найти в файле [`migration/README`](migration/README).

#### Создание новой миграции

После изменения моделей SQLAlchemy необходимо создать новый файл миграции. Выполните команду:

```bash
docker-compose run --rm web poetry run alembic revision --autogenerate -m "Краткое описание миграции"
```

#### Применение миграций вручную

Хотя миграции применяются автоматически при старте, вы можете применить их вручную:

```bash
docker-compose run --rm web poetry run alembic upgrade head
```

### 5. Запуск тестов

Тесты выполняются в изолированном окружении внутри Docker-контейнера.

Чтобы запустить все тесты, выполните команду:

```bash
docker-compose run --rm web poetry run pytest
```

### 6. Остановка приложения

Чтобы остановить все запущенные контейнеры, используйте команду:

```bash
docker-compose down
```


## Структура проекта

```
.
├── app/                  # Основной код приложения
│   ├── api/              # Слой API (контроллеры, роуты, сериализаторы)
│   ├── core/             # Бизнес-логика (сервисы, модели, репозитории)
│   ├── di/               # Контейнеры и провайдеры для DI
│   ├── infra/            # Инфраструктурный слой (адаптеры к БД и т.д.)
│   └── main.py           # Точка входа в приложение FastAPI
├── migration/            # Файлы миграций Alembic
├── tests/                # Тесты
│   ├── api/              # Тесты для API
│   └── factories/        # Фабрики для создания тестовых данных
├── .env.example          # Пример файла с переменными окружения
├── docker-compose.yml    # Конфигурация Docker Compose
├── Dockerfile            # Dockerfile для сборки образа приложения
└── pyproject.toml        # Файл с зависимостями проекта (Poetry)
```